<!doctype html><html lang=en-nz><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=generator content="Hugo 0.74.3"><title>Publishing your Hugo blog on Github Pages with a 'gh-pages' branch | Neil's Notes</title><link rel=canonical href=https://blog.nizmow.net/2020/01/publishing-your-hugo-blog-on-github-pages-with-a-gh-pages-branch/><link rel=stylesheet href=https://blog.nizmow.net/css/base.min.f871a228a576fc99ea91ba72e688c16767a9616cdb8cff47e95e2d11c6b706d7.css integrity="sha256-+HGiKKV2/Jnqkbpy5ojBZ2epYWzbjP9H6V4tEca3Btc=" crossorigin=anonymous></head><body><nav class=u-background><div class=u-wrapper><ul class=Banner><li class="Banner-item Banner-item--title"><a class="Banner-link u-clickable" href=https://blog.nizmow.net/>Neil's Notes</a></li><li class=Banner-item><a class="Banner-link u-clickable" href=https://blog.nizmow.net/about/>About</a></li><li class=Banner-item><a class="Banner-link u-clickable" href=https://blog.nizmow.net/posts/>Posts</a></li><li class=Banner-item><a class="Banner-link u-clickable" href=https://blog.nizmow.net/tags/>Tags</a></li></ul></div></nav><main><div class=u-wrapper><div class=u-padding><article><header class=Heading><h2 class=Heading-title><a class="Heading-link u-clickable" href=https://blog.nizmow.net/2020/01/publishing-your-hugo-blog-on-github-pages-with-a-gh-pages-branch/ rel=bookmark>Publishing your Hugo blog on Github Pages with a 'gh-pages' branch</a></h2><time datetime=2020-01-20T19:13:23+01:00>20 January, 2020</time></header><p>I started this blog with Hugo because it&rsquo;s super fast and simple, and hosting with Github Pages because it&rsquo;s&mldr; super fast and simple. Until now I was building manually and publishing all pages manually to a separate repository, but that was a) tedious and b) limiting my options for eg: writing new posts on my iPad. Today I had some time on my hands and decided to automate this process.</p><h3 id=using-a-gh-pages-branch>Using a <code>gh-pages</code> branch</h3><p>First step was to switch away from a separate Github Pages repository to using a <code>gh-pages</code> branch of the current repository, since having a separate repository seemed messy. Using a separate branch like this seems a bit counterintuitive when you&rsquo;re thinking in the standard model of a git repository looking like a big tree, since we want this branch to live on its own with no relation to <code>master</code>. Git has a name for this type of branch: an <em>orphan</em><sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup>. You can set up an empty orphan branch in an existing repository fairly easily:</p><ol><li>Make sure your <code>master</code> branch is clean (everything is committed).</li><li>Create your <code>gh-pages</code> orphan branch: <code>git checkout --orphan gh-pages</code>.</li><li>Clear out this branch: <code>git reset --hard</code>. It&rsquo;s an orphan, so everything should be gone, but maybe follow up with <code>rm -rf *</code> for stubborn stains.</li><li>We want to push to origin, but we need a commit. Make an empty one with <code>git commit --allow-empty -m "Initial gh-pages commit"</code>.</li><li>Push! <code>git push origin gh-pages</code>.</li><li>Return to master: <code>git checkout master</code>.</li></ol><p>You&rsquo;ve now got an empty <code>gh-pages</code> branch. Now might be a good time to go into your repository settings on Github and configure this branch for hosting.</p><h3 id=manually-publishing-to-the-gh-pages-branch>Manually publishing to the <code>gh-pages</code> branch</h3><p>With this done, you can now publish a Hugo build of your site from your <code>publish</code> folder to your new <code>gh-pages</code> branch. For this we use <a href=https://git-scm.com/docs/git-worktree><code>git worktree</code></a>. Later we can automate this, so it&rsquo;s probably not a good idea to push any changes.</p><ol><li>Make sure your <code>master</code> branch is clean.</li><li>Remove your <code>public/</code> directory and add it to <code>.gitignore</code>.</li><li>Run <code>hugo</code> to build and publish your site. You can now add and commit your published changes: <code>cd public && git add . && git commit -m "gh-pages commit!"</code>.</li><li>Push! <code>git push origin gh-pages</code>.</li></ol><p>If all is well, you should be able to see your published content at the Github Pages site you configured earlier.</p><p>If you intend to automate things, though, it&rsquo;s probably a good idea to get rid of the worktree just added (<code>rm -rf publish/ && git worktree prune</code>) and get started with Github Actions&mldr;</p><h3 id=automate-with-github-actions>Automate with Github Actions</h3><p>Github Actions is a CI platform built into Github, and contributor <a href=https://github.com/crazy-max>crazy-max</a> has built a whole lot of useful Actions to help with publishing Github Pages. There are a few steps to get Actions going on your repository, a good start is clicking the &ldquo;Actions&rdquo; tab and following the instructions. You can see the Actions definitions file I&rsquo;ve used to automate publishing of this blog <a href=https://github.com/nizmow/blog/blob/master/.github/workflows/publish.yml>here</a>&mldr; and if you poke through the commit history you can see some messy trial and error while I try to get things running right.</p><p>With that done, you can push your Hugo code <code>master</code> and in a few seconds your blog will be updated for you. Who needs Wordpress?</p><section class=footnotes role=doc-endnotes><hr><ol><li id=fn:1 role=doc-endnote><p>you could probably do some really wild things with this. Mega-mono-repo? <a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></section><footer><ul class=Tags><li class="Tags-item u-background"><a class="Tags-link u-clickable" href=https://blog.nizmow.net/tags/devops/ rel=tag>devops</a></li><li class="Tags-item u-background"><a class="Tags-link u-clickable" href=https://blog.nizmow.net/tags/github/ rel=tag>github</a></li><li class="Tags-item u-background"><a class="Tags-link u-clickable" href=https://blog.nizmow.net/tags/git/ rel=tag>git</a></li><li class="Tags-item u-background"><a class="Tags-link u-clickable" href=https://blog.nizmow.net/tags/guide/ rel=tag>guide</a></li></ul></footer></article></div></div></main><footer class=Footer><div class=u-wrapper><div class=u-padding><script>(function(){window.counter='https://blog_nizmow_net.goatcounter.com/count'
var script=document.createElement('script');script.async=1;script.src='//gc.zgo.at/count.js';var ins=document.getElementsByTagName('script')[0];ins.parentNode.insertBefore(script,ins)})();</script></div></div></footer></body></html>